(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{3554:(e,t,a)=>{Promise.resolve().then(a.bind(a,7243))},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},7243:(e,t,a)=>{"use strict";a.d(t,{default:()=>p});var r=a(5155),s=a(2115),l=a(2984),n=a(9946);let o=(0,n.A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),i=(0,n.A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);function d(e){let{label:t,type:a="button"}=e;return(0,r.jsx)("button",{type:a,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition",children:t})}function u(e){let{icon:t,type:a,placeholder:s,value:l,onChange:n}=e;return(0,r.jsxs)("div",{className:"flex items-center gap-2 border p-2 rounded-md bg-gray-50 dark:bg-gray-700",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("input",{className:"flex-1 bg-transparent outline-none",type:a,placeholder:s,value:l,onChange:e=>n(e.target.value)})]})}var c=a(5695),h=a(4540),g=a(8990);function p(){let e=(0,h.wA)(),t=(0,c.useRouter)(),{isAuthenticated:a,isLoading:n,error:p,user:m}=(0,h.d4)(g.jc),[y,f]=(0,s.useState)(""),[k,x]=(0,s.useState)(""),[v,w]=(0,s.useState)("");return(0,s.useEffect)(()=>{p&&w(p)},[p]),(0,s.useEffect)(()=>{if(a&&m){let e=m.role;t.push("admin"===e?"/admin/dashboard":"/dashboard")}},[a,m,t]),(0,s.useEffect)(()=>{e((0,g.ET)())},[e]),(0,r.jsxs)(l.P.form,{onSubmit:t=>{if(t.preventDefault(),!y||!k)return void w("Email and password are required.");e((0,g.Lx)({email:y,password:k,role:"user"}))},className:"p-8 rounded-xl shadow-md w-full max-w-md space-y-4",initial:{opacity:0,y:-50},animate:{opacity:1,y:0},children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold text-center",children:"Login"}),(0,r.jsx)(u,{icon:(0,r.jsx)(o,{}),type:"email",placeholder:"Email",value:y,onChange:f}),(0,r.jsx)(u,{icon:(0,r.jsx)(i,{}),type:"password",placeholder:"Password",value:k,onChange:x}),v&&(0,r.jsx)("p",{className:"text-red-500 text-sm",children:v}),(0,r.jsx)(d,{type:"submit",label:n?"Logging in...":"Login"})]})}},8990:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>v,DY:()=>n,ET:()=>c,H$:()=>f,Kc:()=>y,Lx:()=>o,ZB:()=>k,ck:()=>x,im:()=>i,jc:()=>p,mB:()=>m});var r=a(1990),s=a(3464);let l={user:null,token:localStorage.getItem("token"),isLoading:!1,isAuthenticated:!1,error:null,message:null},n=(0,r.zD)("auth/register",async(e,t)=>{let{rejectWithValue:a}=t;try{let t=await s.A.post("".concat("http://localhost:8000/api/","auth/register"),e,{withCredentials:!0}),a=t.data.data||t.data.user,r=t.data.token||"dummy-token";return r&&localStorage.setItem("token",r),{user:a,token:r}}catch(e){var r,l;return a((null==(l=e.response)||null==(r=l.data)?void 0:r.message)||"Registration failed")}}),o=(0,r.zD)("auth/login",async(e,t)=>{let{rejectWithValue:a}=t;try{let t=await s.A.post("".concat("http://localhost:8000/api/","auth/login"),e,{withCredentials:!0}),a=t.data.data,r=t.data.token||"dummy-token";return r&&localStorage.setItem("token",r),{user:a,token:r}}catch(e){var r,l;return a((null==(l=e.response)||null==(r=l.data)?void 0:r.message)||"Login failed")}}),i=(0,r.zD)("auth/fetchUser",async(e,t)=>{let{rejectWithValue:a}=t;try{let e=localStorage.getItem("token"),t=await s.A.get("".concat("http://localhost:8000/api/","auth/"),{withCredentials:!0,headers:e?{Authorization:"Bearer ".concat(e)}:{}});return{user:t.data.data||t.data.user||t.data}}catch(e){var r,l;return a((null==(l=e.response)||null==(r=l.data)?void 0:r.message)||"Failed to get profile")}}),d=(0,r.Z0)({name:"auth",initialState:l,reducers:{clearAuth:e=>{e.user=null,e.token=null,e.isAuthenticated=!1,e.error=null,e.message=null,localStorage.removeItem("token")},clearError:e=>{e.error=null},clearMessage:e=>{e.message=null},setCredentials:(e,t)=>{e.user=t.payload.user,e.token=t.payload.token,e.isAuthenticated=!0,localStorage.setItem("token",t.payload.token)}},extraReducers:e=>{e.addCase(n.pending,e=>{e.isLoading=!0,e.error=null,e.message=null}).addCase(n.fulfilled,(e,t)=>{e.isLoading=!1,e.user=t.payload.user,e.token=t.payload.token,e.isAuthenticated=!0,e.message="Registration successful",e.error=null}).addCase(n.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload||"Registration failed",e.isAuthenticated=!1}).addCase(o.pending,e=>{e.isLoading=!0,e.error=null,e.message=null}).addCase(o.fulfilled,(e,t)=>{e.isLoading=!1,e.user=t.payload.user,e.token=t.payload.token,e.isAuthenticated=!0,e.message="Login successful",e.error=null}).addCase(o.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload||"Login failed",e.isAuthenticated=!1}).addCase(i.pending,e=>{e.isLoading=!0,e.error=null}).addCase(i.fulfilled,(e,t)=>{e.isLoading=!1,e.user=t.payload.user,e.isAuthenticated=!0,e.error=null}).addCase(i.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload||"Failed to get profile",e.isAuthenticated=!1})}}),{clearAuth:u,clearError:c,clearMessage:h,setCredentials:g}=d.actions,p=e=>e.auth,m=e=>e.auth.user,y=e=>e.auth.isAuthenticated,f=e=>e.auth.isLoading,k=e=>e.auth.error,x=e=>{var t;return null==(t=e.auth.user)?void 0:t.role},v=d.reducer}},e=>{e.O(0,[464,635,813,441,964,358],()=>e(e.s=3554)),_N_E=e.O()}]);